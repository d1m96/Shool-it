var express = require('express');var bodyParser = require("body-parser");var router = express.Router();var jsonParser = bodyParser.json(); // создаем парсер для данных в формате jsonvar pgp = require("pg-promise")();var db = pgp("postgres://client:qwerty@localhost:1234/project");var mydata = [1,2,3]//JSON.parse(dataBD);var time;var speed;var productivity;var count;var json = '{"speed":"", "productivity":"", "count":"", "datetime":""}';json = JSON.parse(json);//queries to DBrouter.get('/123', function(req, res, next) {db.many("select begin_date, end_date\n" +    "from work_calendars\n" +    "where descr != 'Working';")    .then(function (data) {        time = data;        time = JSON.stringify(time);        time = JSON.parse(time);    })    .catch(function (error) {        //response.write("ERROR");        console.log("ERROR:", error);    });db.many("select count(*) as v\n" +    "from work_calendars\n" +    "where descr != 'Working';")    .then(function (data) {        count = data;    })    .catch(function (error) {        console.log("ERROR:", error);    });db.many("select value from params join param_values on params.param_id = param_values.param_id where params.name = 'Max speed';")    .then(function (data) {        speed = data;    })    .catch(function (error) {        console.log("ERROR:", error);    });db.many("select value from params join param_values on params.param_id = param_values.param_id where params.name = 'Date production';")    .then(function (data) {        productivity = data;    })    .catch(function (error) {        console.log("ERROR:", error);    });    var i = 0;    var t;        if(count !== undefined && speed !== undefined && time !== undefined) {            count = count[0].v;            productivity = productivity[0].value;            speed = speed[0].value;            json.speed = speed;            json.count = count;            json.productivity = productivity;            json.datetime = time;            res.send(JSON.stringify(json));            console.log(JSON.stringify(json));}});/* GET home page. */router.get('/', function(req, res, next) {    res.render('index', { title: 'Express' });});router.get('/testajax', function(req, res, next) {    res.send(JSON.stringify(mydata));});module.exports = router;